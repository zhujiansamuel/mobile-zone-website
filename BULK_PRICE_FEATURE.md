# 批量价格管理功能

## 功能说明

新增的批量价格管理功能允许管理员在一个页面中统一查看和修改所有商品的价格信息。

### 主要特性

1. **统一价格展示**
   - 在一个表格中显示所有商品的价格信息
   - 支持编辑参考价格（price）和中古价格（price_zg）
   - 实时显示修改状态（修改的输入框会高亮显示）

2. **强大的过滤功能**
   - 按商品标题搜索
   - 按商品分类筛选
   - 按商品状态（上架/下架）筛选

3. **批量保存**
   - 支持一次性修改多个商品的价格
   - 修改后统一保存，使用数据库事务确保数据一致性
   - 保存前显示修改数量确认

4. **用户友好的界面**
   - 显示商品图片、标题、分类等关键信息
   - 价格输入框支持即时编辑
   - 修改的价格会有视觉反馈（黄色高亮）

## 安装步骤

### 1. 数据库配置

执行SQL文件添加菜单项：

```bash
mysql -u your_username -p your_database < bulk_price_menu.sql
```

或者手动在FastAdmin后台添加菜单：

1. 登录后台管理系统
2. 进入 "权限管理" -> "菜单规则"
3. 找到 "商品管理" 菜单
4. 添加子菜单：
   - 名称：`goods/bulkprice`
   - 标题：批量价格管理
   - 图标：fa fa-money
   - 类型：菜单

### 2. 权限配置

在 "权限管理" -> "管理员分组" 中，为需要使用此功能的管理员组添加以下权限：

- `goods/bulkprice` - 批量价格管理页面
- `goods/bulkupdate` - 批量更新价格接口

### 3. 清除缓存

```bash
# 清除FastAdmin缓存
rm -rf runtime/cache/*
rm -rf runtime/temp/*
```

或在后台管理界面点击 "刷新缓存"

## 使用说明

### 访问批量价格管理

1. 登录后台管理系统
2. 进入 "商品管理" -> "批量价格管理"

### 筛选商品

1. 在顶部筛选栏输入条件：
   - 商品标题：支持模糊搜索
   - 分类：从下拉列表选择
   - 状态：上架/下架/全部
2. 点击 "筛选" 按钮应用筛选条件
3. 点击 "重置" 按钮清除筛选条件

### 修改价格

1. 直接在表格中的价格输入框中输入新价格
2. 修改后的输入框会显示黄色高亮，表示已修改但未保存
3. 可以修改多个商品的价格
4. 点击 "批量保存价格" 按钮
5. 确认要保存的商品数量
6. 系统会显示成功更新的商品数量

### 刷新数据

点击 "刷新" 按钮可以重新加载商品数据，未保存的修改会被清除。

## 文件清单

以下是新增或修改的文件：

1. **控制器**
   - `application/admin/controller/Goods.php`
     - 新增 `bulkprice()` 方法：批量价格管理页面
     - 新增 `bulkupdate()` 方法：批量更新价格接口

2. **视图**
   - `application/admin/view/goods/bulkprice.html`：批量价格管理页面模板

3. **JavaScript**
   - `public/assets/js/backend/goods.js`
     - 新增 `bulkprice` 方法：前端逻辑处理

4. **语言文件**
   - `application/admin/lang/zh-cn/goods.php`：新增中文翻译

5. **SQL脚本**
   - `bulk_price_menu.sql`：菜单添加脚本

## 技术说明

### 前端技术

- Bootstrap Table：表格展示和分页
- jQuery：事件处理和AJAX请求
- FastAdmin框架：表单处理和提示信息

### 后端技术

- ThinkPHP 5：MVC框架
- 数据库事务：确保批量更新的原子性
- 权限控制：基于FastAdmin的权限系统

### 安全特性

- 所有价格更新都经过权限验证
- 使用数据库事务确保数据一致性
- 价格值会转换为浮点数，防止非法输入
- 支持FastAdmin的标准权限控制

## 注意事项

1. 修改价格后必须点击 "批量保存价格" 才会生效
2. 刷新页面或点击 "刷新" 按钮会清除未保存的修改
3. 建议在修改大量商品价格时分批操作
4. 价格字段支持小数，系统会自动转换为数字类型

## 未来扩展建议

1. 添加价格批量调整功能（如统一上调/下调百分比）
2. 添加价格历史记录功能
3. 支持导入/导出价格数据
4. 添加价格变更审核流程
